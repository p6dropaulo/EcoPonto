# üìñ Documenta√ß√£o T√©cnica (Wiki) - Projeto EcoPonto

---

## 1. Arquitetura do Sistema

O EcoPonto utiliza uma **Arquitetura em Camadas** baseada no padr√£o **MVC (Model-View-Controller)**. A separa√ß√£o de responsabilidades garante que a l√≥gica de neg√≥cio esteja isolada da interface de entrada (API) e do acesso a dados.

### Camadas da Arquitetura

| Camada       | Responsabilidade                                                                                           |
|--------------|-----------------------------------------------------------------------------------------------------------|
| **Controller** | Respons√°vel por expor os endpoints REST, validar as entradas via DTOs e gerenciar os status de resposta HTTP. |
| **Service**    | Centraliza as regras de neg√≥cio. √â onde as valida√ß√µes l√≥gicas ocorrem antes de qualquer persist√™ncia.        |
| **Repository** | Abstra√ß√£o de acesso ao banco de dados utilizando Spring Data JPA.                                          |
| **Security**   | Filtros e utilit√°rios que garantem a integridade das rotas.                                                 |

---

## 2. Modelagem de Dados e Relacionamentos

A persist√™ncia √© feita de forma relacional. Abaixo, a descri√ß√£o das principais entidades:

### Entidades Principais

- **Usuario**: Entidade base para seguran√ßa. Armazena `email`, `senha` (encriptada) e o `TipoUsuario` (`ROLE_DOADOR` ou `ROLE_ASSOCIACAO`).

- **Doador**: Relaciona-se com `Usuario`. Cont√©m dados espec√≠ficos como `CPF`. Possui uma rela√ß√£o de **Um para Muitos (1:N)** com `Item`.

- **Associacao**: Relaciona-se com `Usuario`. Cont√©m dados como `CNPJ` e `Endereco`.

- **Item**: Representa o material recicl√°vel. Cont√©m informa√ß√µes de peso, material e localiza√ß√£o. √â vinculado obrigatoriamente a um `Doador`.

---

## 3. Fluxo de Seguran√ßa e JWT

O sistema implementa seguran√ßa **Stateless** (sem estado no servidor).

### Processo de Autentica√ß√£o

1. **Emiss√£o**: Ao fazer login com sucesso, o `AuthService` gera um token JWT assinado com uma chave secreta.

2. **Valida√ß√£o**: Em cada requisi√ß√£o protegida, o `JwtAuthenticationFilter` captura o token no header `Authorization`.

3. **Contexto**: O `JwtUtil` valida a assinatura e a expira√ß√£o. Se v√°lido, o usu√°rio √© autenticado no `SecurityContextHolder` do Spring Security.

4. **Criptografia**: Todas as senhas s√£o armazenadas utilizando o algoritmo **BCrypt**, garantindo que, mesmo em caso de vazamento de banco de dados, as senhas originais n√£o sejam expostas.

---

## 4. Padr√µes de Projeto (Design Patterns)

Para manter o c√≥digo limpo e sustent√°vel, aplicamos os seguintes padr√µes:

| Padr√£o                         | Descri√ß√£o                                                                                                                                                           |
|--------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **DTO (Data Transfer Object)** | Utilizado para receber dados (`CreateDto`) e retornar dados (`Dto`), evitando que a entidade do banco seja exposta diretamente na API.                              |
| **Mapper**                     | Componentes dedicados a converter objetos. Ex: Transforma um `ItemCreateDto` em uma entidade `Item`.                                                                |
| **Global Exception Handler**   | Um `@ControllerAdvice` que intercepta erros em qualquer ponto da aplica√ß√£o e devolve um JSON padronizado com mensagens de erro claras.                              |

---

## 5. Ambientes de Execu√ß√£o

O projeto utiliza **Spring Profiles** para facilitar a transi√ß√£o entre ambientes:

### Perfis Dispon√≠veis

| Perfil  | Descri√ß√£o                                                                                                                                                      |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **DEV** (Development) | Ativado via `spring.profiles.active=DEV`. Utiliza o banco de dados **H2** em modo arquivo. √â ideal para desenvolvimento local e debug r√°pido.    |
| **PRD** (Production/Docker) | Utiliza **PostgreSQL**. As configura√ß√µes s√£o injetadas via vari√°veis de ambiente no `docker-compose.yml`, garantindo que credenciais sens√≠veis n√£o fiquem expostas no c√≥digo fonte. |

---

## 6. Tratamento de Erros

A aplica√ß√£o padroniza as respostas de erro. Por exemplo, se um usu√°rio tentar cadastrar um CPF j√° existente, o sistema lan√ßar√° uma exce√ß√£o capturada pelo `GlobalExceptionHandler`, retornando:

### Exemplo de Resposta de Erro

- **Status HTTP:** `400 Bad Request`
- **Corpo da Resposta:**

```json
{
  "message": "CPF j√° cadastrado no sistema",
  "timestamp": "2026-02-03T14:30:00"
}
```
